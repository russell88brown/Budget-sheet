# Conceptual Model

## Accounts
An **account** is any balance that should be forecasted.

- Cash accounts
  - Holding
  - Savings
  - Bucket accounts (Car Fund, Holiday Fund, etc.)
- Credit accounts
  - Credit Card
  - Loans

Balances in `Accounts` represent **"now"**.

---

## External
Anything not modeled as an account:
- merchants
- rent
- utilities
- subscriptions

---

## Money movements
There are only two kinds of movements:

| Movement | Description |
|-------|------------|
| Expense | Money leaves the system (`Paid To = External`) |
| Transfer | Money moves between accounts (`Paid To = Account`) |

This distinction is **implied**, not stored as a separate type.

---

## Expense Behaviors (core abstraction)

Every expense rule has a **Behavior** that determines how the engine treats it.

| Behavior | Purpose |
|-------|--------|
| Scheduled | Known, expected payments |
| Provision | Regular allocation into a bucket |
| CapOnly | Informational budget caps |
| OneOff | Single known future payment |

This allows routine, non-routine, and discretionary spending to coexist cleanly.

---

## Recurrence Model

The recurrence system is **anchored and deterministic**.

Each recurring rule defines:
- a **Frequency**
- an **Anchor Date**

Future events are generated by stepping forward from the anchor.

### Supported frequencies

| Frequency | Step |
|--------|-----|
| Weekly | +7 days |
| Fortnightly | +14 days |
| Monthly | +1 month |
| Quarterly | +3 months |
| SemiAnnually | +6 months |
| Annually | +12 months |
| Once | no recurrence |

Notes:
- Monthly+ steps clamp to end-of-month if needed
- Fortnightly is intentionally anchored (matches real pay cycles)
- Calendar-aligned quarters are intentionally **not** modeled

---

## Bucket Accounts (Provisioning)

Bucket accounts are **normal Cash accounts** used for planning.

Examples:
- Car Fund
- Holiday Fund
- Emergency Fund

### How they work
- Provision rules transfer money into buckets
- Buckets are never auto-spent by the engine
- When real spending occurs:
  - user updates the bucket balance
  - reruns forecast

This keeps the model forward-only and avoids fake future transactions.

---

## Invariants (guarantees)

- Forecast is always forward-only
- Outputs are fully reproducible
- No hidden state
- Buckets are never auto-spent
- CapOnly rules never affect balances
- Updating balances is the only way to reflect reality
