<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 13px;
        margin: 16px;
        color: #1f1f1f;
      }
      label {
        display: block;
        margin-bottom: 8px;
      }
      .check {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 6px 0;
      }
      select {
        width: 100%;
        padding: 6px;
        box-sizing: border-box;
      }
      .actions {
        margin-top: 14px;
        display: flex;
        gap: 8px;
        justify-content: flex-end;
      }
      button {
        padding: 6px 12px;
        border-radius: 4px;
        border: 1px solid #1a73e8;
        background: #1a73e8;
        color: #ffffff;
        cursor: pointer;
      }
      button.secondary {
        background: #ffffff;
        color: #1a73e8;
      }
      #status {
        margin-top: 10px;
        color: #5f6368;
        min-height: 16px;
      }
    </style>
  </head>
  <body>
    <form id="scenario-form">
      <label>Choose what to run</label>
      <label class="check"><input type="checkbox" name="action" value="journal"> Journal</label>
      <label class="check"><input type="checkbox" name="action" value="summary"> Summaries</label>
      <? if (mode === 'custom') { ?>
      <label for="scenarios" style="margin-top: 10px;">Scenarios (multi-select)</label>
      <select id="scenarios" multiple size="6" required>
        <? for (var i = 0; i < scenarios.length; i++) { var item = scenarios[i]; ?>
          <option value="<?= item ?>"><?= item ?></option>
        <? } ?>
      </select>
      <div style="margin-top: 6px; color: #5f6368; font-size: 12px;">
        Hold Ctrl/Cmd to select multiple scenarios.
      </div>
      <? } else { ?>
      <div style="margin-top: 8px; color: #5f6368; font-size: 12px;">
        Main scenario is fixed to <strong><?= defaultScenario ?></strong>.
      </div>
      <? } ?>
      <div class="actions">
        <button type="submit">Run</button>
        <button type="button" class="secondary" onclick="google.script.host.close()">Cancel</button>
      </div>
      <div id="status"></div>
    </form>
    <script>
      (function () {
        var form = document.getElementById('scenario-form');
        var statusEl = document.getElementById('status');
        var mode = '<?= mode ?>';

        form.addEventListener('submit', function (event) {
          event.preventDefault();
          var actions = Array.prototype.slice
            .call(form.querySelectorAll('input[name="action"]:checked'))
            .map(function (el) { return el.value; });
          if (!actions.length) {
            statusEl.textContent = 'Select at least one action.';
            return;
          }
          var scenarios = [];
          if (mode === 'custom') {
            scenarios = Array.prototype.slice
              .call(document.getElementById('scenarios').selectedOptions)
              .map(function (option) { return option.value; });
            if (!scenarios.length) {
              statusEl.textContent = 'Select at least one scenario.';
              return;
            }
          }
          google.script.run.runScenarioSelections(mode, actions, scenarios);
          google.script.host.close();
        });
      })();
    </script>
  </body>
</html>
